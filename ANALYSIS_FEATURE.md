# 🔍 AI项目分析功能 - MVP版本

## 📋 功能概述

AI项目分析功能是OpenInsight平台的核心模块之一,通过调用通义千问大模型,对GitHub开源项目进行深度分析,生成专业的项目健康度报告。

### 核心特性

1. **极简交互** - 3步完成分析:选项目 → 选指标 → AI生成报告
2. **智能分析** - 基于8个维度的专业分析框架
3. **实时流式输出** - AI分析过程实时可见
4. **支持对比** - 最多支持2个项目的横向对比分析
5. **Markdown渲染** - 专业排版的分析报告

## 🎯 使用指南

### 第一步: 选择项目

- 支持搜索和下拉选择
- 单个项目:获得完整深度分析
- 两个项目:获得对比分析报告
- 最多选择2个项目

### 第二步: 选择分析维度

#### 可用指标

| 指标 | 说明 |
|------|------|
| OpenRank | 综合衡量项目影响力,考虑活跃度、贡献者数量和质量 |
| PREI | PR效率指数,反映项目响应速度和维护质量 |
| 项目活跃度 | 提交频率、Issue处理等整体活跃程度 |
| 开发者活跃度 | 开发者的参与度和活跃程度 |
| 项目关注度 | Star、Fork、Watch等关注指标 |

#### 时间范围

- 最近3个月
- 最近6个月
- 最近12个月 (推荐)
- 全部时间

### 第三步: 查看AI分析报告

点击"开始AI分析"后,系统将经历4个阶段:

1. **数据加载** - 从数据库获取项目指标数据
2. **趋势计算** - 计算统计信息、检测拐点
3. **AI分析** - 调用通义千问大模型进行深度分析
4. **报告生成** - 实时流式输出Markdown格式报告

## 📊 分析报告结构

### 单项目分析 (7个维度)

1. **趋势总体分析** - 所选时间范围内各指标的整体趋势
2. **项目健康度诊断** - 综合评估项目健康状态(优秀/良好/中等/风险)
3. **关键拐点检测** - 识别并分析数据中的关键拐点及原因
4. **风险预警** - 潜在风险点(活跃度下降、PR效率降低等)
5. **优势亮点** - 总结项目的优势和亮点
6. **改进建议** - 3-5条具体的改进建议
7. **未来趋势预测** - 基于历史数据预测未来3-6个月趋势

### 两项目对比分析 (8个维度)

在单项目分析的基础上,增加:

4. **项目对比分析** - 分析两个项目在各维度的差异和相似度

## 🛠️ 技术实现

### 前端技术栈

```
- Vue 3 + TypeScript
- Ant Design Vue (UI组件)
- marked (Markdown渲染)
- dayjs (时间处理)
```

### 后端技术栈

```
- Node.js + Express
- OpenAI SDK (调用通义千问)
- MySQL (数据存储)
```

### API接口

#### 1. 获取分析数据
```
POST /api/home/getAnalysisData

Request:
{
  "projectIds": [38, 41],
  "metrics": ["openrank", "prei", "project_activity"],
  "timeRange": "12months"
}

Response:
{
  "code": 200,
  "msg": "操作成功",
  "data": [
    {
      "project_id": 38,
      "project_name": "owner/repo",
      "metrics": {
        "openrank": {
          "timeSeries": {"2024-01": 123.45, ...},
          "stats": {
            "min": 100.0,
            "max": 150.0,
            "avg": 125.0,
            "trend": 10.5
          },
          "turningPoints": [...]
        }
      }
    }
  ]
}
```

#### 2. 生成AI分析报告 (流式)
```
POST /api/home/generateAIAnalysis

Request:
{
  "projectsData": [...],
  "metrics": ["openrank", "prei"],
  "timeRange": "12months"
}

Response: (Server-Sent Events)
data: {"content": "## 一、"}
data: {"content": "趋势"}
data: {"content": "总体"}
data: {"content": "分析\n\n"}
...
data: [DONE]
```

## 🚀 启动说明

### 后端启动

```bash
cd backend
npm install
npm start
```

服务器将运行在 `http://127.0.0.1:8081`

### 前端启动

```bash
cd fronted
npm install
npm run dev
```

前端将运行在 `http://localhost:5173`

### 访问分析页面

打开浏览器访问: `http://localhost:5173/#/analysis`

## ⚠️ 注意事项

### API Key管理

当前使用的通义千问API Key已硬编码在 `backend/router_handler/analysis.js` 中:

```javascript
const client = new OpenAI({
  apiKey: "sk-829bda5565e04302b9bd5a088f0247c3",
  baseURL: "https://dashscope.aliyuncs.com/compatible-mode/v1",
});
```

**生产环境建议:**
- 将API Key移至环境变量或配置文件
- 实现API调用次数限制
- 添加错误重试机制

### 性能优化建议

1. **缓存机制**: 相同条件的分析结果可以缓存,避免重复调用AI
2. **并发限制**: 限制同时进行的AI分析请求数量
3. **超时处理**: 设置合理的超时时间(建议60秒)

### 数据要求

- 时间序列数据格式: `{"YYYY-MM": number}`
- 项目至少需要3个月的数据才能生成有意义的分析
- 指标值应为数值类型,null/undefined会被过滤

## 🎨 界面预览

### 页面结构

```
┌─────────────────────────────────────┐
│     🔍 AI项目深度分析              │
├─────────────────────────────────────┤
│ 1️⃣ 选择项目                        │
│   [项目选择器 - 多选下拉框]         │
├─────────────────────────────────────┤
│ 2️⃣ 选择分析维度                    │
│   指标选择: ☑ OpenRank ☑ PREI ...   │
│   时间范围: ◉ 最近12个月            │
├─────────────────────────────────────┤
│        [开始AI分析] 按钮            │
├─────────────────────────────────────┤
│ 3️⃣ AI分析报告                      │
│   ┌───────────────────────────────┐ │
│   │ ## 一、趋势总体分析           │ │
│   │ ...                           │ │
│   │ ## 二、项目健康度诊断         │ │
│   │ ...                           │ │
│   └───────────────────────────────┘ │
│   [导出PDF报告] 按钮 (开发中)      │
└─────────────────────────────────────┘
```

## 📝 后续计划

### V1.0版本 (下一阶段)

- [ ] PDF导出功能 (含项目logo、图表缩略图)
- [ ] 历史报告管理 (查看之前的分析)
- [ ] 报告分享功能 (生成分享链接)
- [ ] 增加更多分析维度 (代码质量、社区健康度等)

### V2.0版本 (长期)

- [ ] 自定义分析模板
- [ ] 定时生成报告 + 邮件推送
- [ ] 多项目批量分析 (3-5个项目)
- [ ] 分析报告对比功能

## 🤝 贡献指南

如需扩展AI分析的维度或优化Prompt,请编辑:

```
backend/router_handler/analysis.js
```

关键函数:
- `getAnalysisData` - 数据获取和预处理
- `generateAIAnalysis` - AI分析Prompt和流式输出
- `calculateStats` - 统计信息计算
- `detectTurningPoints` - 拐点检测算法

## 📧 联系方式

如有问题或建议,请提交Issue或PR。

---

**MVP版本已完成 ✅**
- ✅ 项目选择器 (1-2个项目)
- ✅ 指标和时间范围选择
- ✅ AI流式分析
- ✅ Markdown渲染展示
- ⏳ PDF导出 (待开发)
